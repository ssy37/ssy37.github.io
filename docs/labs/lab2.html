<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Lab 2</title>
  <meta name="description" content="">
  <meta name="keywords" content="">

  <!-- Favicons -->
  <link href="../assets/img/favicon.png" rel="icon">
  <link href="../assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="../assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="../assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="../assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="../assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="../assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="../assets/css/main.css" rel="stylesheet">

  <!-- =======================================================
  * Template Name: MyPortfolio
  * Template URL: https://bootstrapmade.com/myportfolio-bootstrap-portfolio-website-template/
  * Updated: Aug 08 2024 with Bootstrap v5.3.3
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
</head>

<body class="portfolio-details-page">

  <header id="header" class="header d-flex align-items-center sticky-top">
    <div class="container-fluid  position-relative d-flex align-items-center justify-content-between">

      <a href="../index.html" class="logo d-flex align-items-center">
        <!-- Uncomment the line below if you also wish to use an image logo -->
        <!-- <img src="../assets/img/logo.png" alt=""> -->
        <h1 class="sitename">ssy37 Fast Robots</h1>
      </a>

      <nav id="navmenu" class="navmenu">
        <ul>
          <li><a href="../index.html">Home</a></li>
          <li><a href="../about.html">About</a></li>
          <li class="dropdown"><a href="#"><span>Labs</span> <i class="bi bi-chevron-down toggle-dropdown"></i></a>
            <ul>
              <li><a href="labs/lab1A.html">Lab 1A</a></li>
              <li><a href="labs/lab1B.html">Lab 1B</a></li>
              <li><a href="labs/lab2.html">Lab 2</a></li>
              <li><a href="#">Lab 3</a></li>
              <li><a href="#">Lab 4</a></li>
              <li><a href="#">Lab 5</a></li>
              <li><a href="#">Lab 6</a></li>
              <li><a href="#">Lab 7</a></li>
              <li><a href="#">Lab 8</a></li>
              <li><a href="#">Lab 9</a></li>
              <li><a href="#">Lab 10</a></li>
              <li><a href="#">Lab 11</a></li>
              <li><a href="#">Lab 12</a></li>
            </ul>
          </li>
          <li><a href="contact.html">Contact</a></li>
        </ul>
        <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
      </nav>

    </div>
  </header>

  <main class="main">

    <!-- Page Title -->
    <div class="page-title light-background">
      <div class="container">
        <h1>Lab 2</h1>
        <nav class="breadcrumbs">
          <ol>
            <li><a href="../index.html">Home</a></li>
            <li class="current">Lab 2</li>
          </ol>
        </nav>
      </div>
    </div><!-- End Page Title -->

    <div class="content-container">
      <div class="text-content">
        <h1>Objective</h1>
        <p>Lab 2 introduces the IMU. Through the tasks, data is collected via the IMU's 
          accelerometer and gyroscope. Various filtering techniques are used to get clean, accurate signals. 
          In this lab, we also received the physical robot and performed stunts with it.
        </p>
      </div>
      <div class="text-content">
        <h1>Setup</h1>
        <h2>AD0_VAL</h2>
        <p>According to lecture 4 code, AD0_VAL is the value of the last bit on the I2C address. 
          It is currently 1 because the AD0 pin doesn't have anything soldered to it.
        </p>

        <h2>IMU example code</h2>
        <p>I ran the IMU’s example code to observe accelerometer and gyroscope data. The accelerometer 
          measures in "mg" (milli-gravity), with one axis always reading ±1000 mg due to gravity, depending on 
          orientation. The gyroscope, in "DPS" (degrees per second), is unaffected by gravity.
        </p>
        <div class="media-container">          
          <iframe 
            src="https://www.youtube.com/embed/kDlruMnDshk"
            title="IMU example code" 
            frameborder="0" 
            allowfullscreen 
            class="media-item">
          </iframe>
        </div>
        

        <h2>Blink LED</h2>
        <p>
          To help me indicate whether or not my board is running, I implemented a blink sequence 
          in my setup function.
        </p>
        <div class="media-container">
          <img src="../assets/img/lab2_img/setup_blinkLED.jpg" alt="blink LED" class="media-item">
          
          <iframe 
            src="https://www.youtube.com/embed/0fKc6JQ7Z0I" 
            title="Blink LED" 
            frameborder="0" 
            allowfullscreen 
            class="media-item">
          </iframe>
        </div>
      </div>
      
      <div class="text-content">
        <h1>Accelerometer</h1>
        <p>
          After validating that the IMU was set up correctly, I collected accelerometer data to compute 
          pitch and roll angles (recall that the accelerometer cannot detect yaw).
        </p>
        <div class="media-container">
          <figure class="media-item">
            <iframe 
              src="https://www.youtube.com/embed/clrJ5XUUzwk" 
              title="Roll" 
              frameborder="0" 
              allowfullscreen 
              class="media-item">
            </iframe>
            <figcaption>Accelerometer roll</figcaption>
          </figure>
          
          <figure>
            <iframe 
              src="https://www.youtube.com/embed/ab8aX_nT9qM" 
              title="Pitch" 
              frameborder="0" 
              allowfullscreen 
              class="media-item">
            </iframe>
            <figcaption>Accelerometer pitch</figcaption>
          </figure>
          
        </div>

        <h2>Two-point calibration</h2>
        <p>
          I noticed that the data is smoother if I do not touch the board. For the two videos above, 
          I was applying a decent amount of force to the board to keep it in position. Thus, the data 
          was quite noisy. The numbers are close enough to what I expect them to be, so I thought a 
          two-point calibration was not necessary.
        </p>

        <h2>Data collection</h2>
        <p>
          In Python, I implemented a notification handler that would receive the accelerometer data 
          (timestamps, pitch, roll) as a string and store it into separate lists as floats. Then, I 
          used matplotlib to plot the data. In Arduino, I implemented a command, “GET_ACCEL”, that would 
          collect accelerometer data for a specified duration. The command has two loops: the first computes 
          pitch and roll angles from accelerometer data and adds them to separate arrays. The second send 
          the data via BLE to the computer.
        </p>
        <div class="media-container">
          <figure class="media-item">
            <img src="../assets/img/lab2_img/accel_notif_handler.jpg" class="media-item">
            <figcaption>Notification handler in Python</figcaption>
          </figure>
          
          <figure class="media-item">
            <img src="../assets/img/lab2_img/get_accel_overview.jpg" class="media-item">
            <figcaption>Command used to get accelerometer data</figcaption>
          </figure>
        </div>
        
        <p>
          For this task, I rotated the board about its x-axis so I expected pitch to be ~0. 
          I chose to collect 3 seconds worth of data; I verified this by computing the time elapsed 
          from the timestamps list that was sent over.
        </p>

        <h2>Fourier transform and low-pass filter</h2>
        <p>
          The raw accelerometer data is noisy, so a low-pass filter helps. A high cutoff keeps more noise, 
          while a low cutoff over-smooths and may lose details. I needed to find the optimal cutoff frequency.
        </p>
        <div class="media-container">
          <figure class="media-item">
            <img src="../assets/img/lab2_img/accel_raw.jpg" class="media-item">
            <figcaption>Raw accelerometer data</figcaption>
          </figure>
        </div>
        <p>
          To determine the cutoff, I analyzed the signal’s frequency spectrum by performing a Fourier transform 
          on my data. The raw data shows ~1Hz oscillations, confirmed by a frequency spectrum spike. Weak 
          signals appear up to 3-4Hz, so I include these frequencies. Using α=T/(T+RC)  and f=1/(2πRC), I find 
          α≈0.07.
        </p>
        <div class="media-container">
          <figure class="media-item">
            <img src="../assets/img/lab2_img/accel_fourier.jpg" class="media-item">
            <figcaption>Frequency spectrum for this dataset</figcaption>
          </figure>
          
          <figure class="media-item">
            <img src="../assets/img/lab2_img/accel_periodogram_zoom.jpg" class="media-item">
            <figcaption>Periodogram generated using scipy.signal.periodogram()</figcaption>
          </figure>
        </div>

        <p>
          I added the LPF code to my GET_ACCEL command. The updated code and filtered signal are shown:
        </p>
        <div class="media-container">
          <figure class="media-item">
            <img src="../assets/img/lab2_img/accel_collect_loop.jpg" class="media-item">
            <figcaption>Data collection loop in GET_ACCEL</figcaption>
          </figure>
          
          <figure class="media-item">
            <img src="../assets/img/lab2_img/accel_data_lpf.jpg" class="media-item">
            <figcaption>Filtered signal with original</figcaption>
          </figure>
        </div>

        <p>
          I also tested how effective the LPF would be when handling vibrational noise. I tapped the 
          table twice while the IMU was sitting flat. The raw data from this experiment shows two 
          main spikes. As seen in the image, the spikes and noise subside substantially after applying the LPF. 
        </p>
        <div class="media-container">
          <img src="../assets/img/lab2_img/accel_vibe_lpf.jpg" class="media-item">
        </div>
      </div>

      <div class="text-content">
        <h1>Gyroscope</h1>
        <p>
          Next, I collected data from the gyroscope to compute pitch, roll, and yaw angles. The data 
          reflects the sensor being rotated about its x-axis, so I don't expect pitch or yaw to change much.
        </p>

        <h2>Comparison to accelerometer</h2>
        <p>
          There are clear differences between the gyroscope and accelerometer data. Unlike the accelerometer, 
          the gyroscope is able to detect yaw by sensing acceleration about the z-axis. The gyroscope data is 
          significantly less noisy than the accelerometer data, but drift is very apparent, especially 
          in pitch data. The gyroscope’s roll signal also seems to undershoot its actual amplitude by a 
          significant margin.
        </p>
        <div class="media-container">
          <img src="../assets/img/lab2_img/accel_gyro_compare.jpg" class="media-item">
        </div>

        <h2>Complementary filter</h2>
        <p>
          I implemented the complementary filter as follows: angle_c = (weight)*angle_accel + 
          (1-weight)*angle_gyro. I collected data for 4.5 seconds to validate that my complementary 
          filter can mitigate drift. To stay consistent with previous trials, I rotated the board about 
          its x-axis again, so I am expecting pitch to be ~0.
        </p>
        <div class="media-container">
          <figure class="media-item">
            <img src="../assets/img/lab2_img/complement_30.jpg" class="media-item">
            <figcaption>Weight = 0.3</figcaption>
          </figure>
          
          <figure class="media-item">
            <img src="../assets/img/lab2_img/complement_50.jpg" class="media-item">
            <figcaption>Weight = 0.5</figcaption>
          </figure>

          <figure class="media-item">
            <img src="../assets/img/lab2_img/complement_80.jpg" class="media-item">
            <figcaption>Weight = 0.8</figcaption>
          </figure>
        </div>
        <p>
          I also tested to see if the complementary filter could mitigate quick vibrations by tapping 
          on the table while the board laid flat.
        </p>
        <div class="media-container">
          <figure class="media-item">
            <img src="../assets/img/lab2_img/complement_30_vibe.jpg" class="media-item">
            <figcaption>Weight = 0.3</figcaption>
          </figure>
          
          <figure class="media-item">
            <img src="../assets/img/lab2_img/complement_50_vibe.jpg" class="media-item">
            <figcaption>Weight = 0.5</figcaption>
          </figure>

          <figure class="media-item">
            <img src="../assets/img/lab2_img/complement_80_vibe.jpg" class="media-item">
            <figcaption>Weight = 0.8</figcaption>
          </figure>
          <p>From the plots generated, a weight of 0.5 is a good choice.</p>
        </div>
      </div>

      <div class="text-content">
        <h1>Sampling data</h1>
        <p>
          I stored gyroscope and accelerometer data in separate arrays. When sending data, 
          I loop through the arrays, combine each entry with a timestamp into a string, and write to 
          the string characteristic. Keeping them separate simplifies looping, data combination, and 
          debugging. For previous tasks, I computed pitch and roll angles in the same loop but stored 
          them separately for the same reasons.
        </p>
        <div class="media-container">
          <figure class="media-item">
            <img src="../assets/img/lab2_img/stream_data_collect_loop.jpg" class="media-item">
            <figcaption>Data collection loop</figcaption>
          </figure>
          
          <figure class="media-item">
            <img src="../assets/img/lab2_img/stream_data_arrays.jpg" class="media-item">
            <figcaption>Data arrays used in the lab</figcaption>
          </figure>
        </div>
        <p>
          I needed a space-efficient data type since BLE limits me to 150 bytes per transfer. 
          Strings were too large, and unsigned longs couldn’t store negative values. Between floats 
          and doubles, floats take less space, so I chose floats.
        </p>
        <br>
        <p>I implemented a STREAM_DATA command to collect raw IMU data. I was able to collect 5 
          seconds of data at ~300Hz. For previous tasks, I observed a similar sampling rate.
        </p>
        <div class="media-container">
          <figure class="media-item">
            <img src="../assets/img/lab2_img/stream_data_python.jpg" class="media-item">
            <figcaption>Computed sampling time and rate</figcaption>
          </figure>
        </div>
        <p>
          I used float arrays of 1600 (6.4kB each). At 300Hz sampling, this stores 5.28s of data. 
          With 384kB RAM, the Artemis can hold up to 316.8s, though some RAM is needed for variables.
        </p>
      </div>

      <div class="text-content">
        <h1>Stunts</h1>
        <p></p>
      </div>
    
      
      <div class="text-content">
        <h1>Discussion and acknowledgements</h1>
        <p>
          Lab 2 was very helpful for familiarizing myself with the IMU.... 
        </p>
      </div>
    </div>

  </main>

  <footer id="footer" class="footer light-background">

    <div class="container">
      <div class="copyright text-center ">
        <p>© <span>Copyright</span> <strong class="px-1 sitename">ssy37 Fast Robots</strong> <span>All Rights Reserved</span></p>
      </div>
      <div class="social-links d-flex justify-content-center">
        <a href=""><i class="bi bi-linkedin"></i></a>
      </div>
      <div class="credits">
        <!-- All the links in the footer should remain intact. -->
        <!-- You can delete the links only if you've purchased the pro version. -->
        <!-- Licensing information: https://bootstrapmade.com/license/ -->
        <!-- Purchase the pro version with working PHP/AJAX contact form: [buy-url] -->
        Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a>
      </div>
    </div>

  </footer>

  <!-- Scroll Top -->
  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Preloader -->
  <div id="preloader"></div>

  <!-- Vendor JS Files -->
  <script src="../assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="../assets/vendor/php-email-form/validate.js"></script>
  <script src="../assets/vendor/aos/aos.js"></script>
  <script src="../assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="../assets/vendor/imagesloaded/imagesloaded.pkgd.min.js"></script>
  <script src="../assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="../assets/vendor/swiper/swiper-bundle.min.js"></script>

  <!-- Main JS File -->
  <script src="../assets/js/main.js"></script>

</body>

</html>